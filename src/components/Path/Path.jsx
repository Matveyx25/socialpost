import { gsap } from "gsap";
import { MotionPathPlugin } from "gsap/MotionPathPlugin";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import React, { useEffect, useRef } from "react";
import s from "./Path.module.scss";
import { Stars } from "./Stars";

gsap.registerPlugin(MotionPathPlugin, ScrollTrigger);

export const Path = ({start}) => {
	let star = useRef(null)
	let path = useRef(null)

	useEffect(() => {
		if(path){
			const length = path.getTotalLength();
	
			path.style.strokeDasharray = length + 6;
			path.style.strokeDashoffset = length + 6;
			
			window.addEventListener("scroll", function () {
				const scrollpercent = (document.body.scrollTop + document.documentElement.scrollTop) / (document.documentElement.scrollHeight - document.documentElement.clientHeight)
				const draw = length * scrollpercent;
				path.style.strokeDashoffset = length - draw > 0 ? length - draw : 0;
			});

			gsap.to(star, {
				scrollTrigger: {
					trigger: ".motion-section",
					start: "bottom bottom",
					scrub: 1,
				},
				duration: 1,
				ease: "none",
				immediateRender: true,
				motionPath: {
					path: path,
					align: path,
					alignOrigin: [0.5, 0.5],
					// autoRotate: 90,
				},
			})
		}

		return () => {
			window.removeEventListener('scroll')
		}
	}, [path])

  return (
    <div className={s.container}>
      <svg
        width="1158"
        height="1402"
        viewBox="0 0 1158 1402"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
				>
        <path
					ref={(ref) => (path = ref)}
          d="M188.184 1C156.351 27.6667 111.784 94.4 188.184 148C268.713 204.497 389.06 174.602 466.184 232.791C497.793 260.71 504.021 275.622 504.021 275.622C547.874 348.132 702.691 535.725 864.331 593.479C929.049 616.603 994.477 618.895 1053.68 585C1257.18 468.5 1118.18 210.5 988.684 275.5C887.199 326.439 819.798 446.162 727.765 516.513C702.36 535.932 675.078 551.59 644.684 561C549.176 590.57 416 663.5 377 811.5L339.273 883.631C324.545 942.946 293.139 1030.82 190.886 1090.71C98.4208 1144.86 1 1138.86 1 1074.5C1 984.086 145.266 967.699 240.997 1054.25C262.265 1073.48 281.137 1097.79 295.5 1127.5C354 1248.5 358 1336 446 1401"
          stroke="#000"
          stroke-dasharray="6 6"
					stroke-width="4px" 
        />
        <path
          d="M188.184 1C156.351 27.6667 111.784 94.4 188.184 148C268.713 204.497 389.06 174.602 466.184 232.791C497.793 260.71 504.021 275.622 504.021 275.622C547.874 348.132 702.691 535.725 864.331 593.479C929.049 616.603 994.477 618.895 1053.68 585C1257.18 468.5 1118.18 210.5 988.684 275.5C887.199 326.439 819.798 446.162 727.765 516.513C702.36 535.932 675.078 551.59 644.684 561C549.176 590.57 416 663.5 377 811.5L339.273 883.631C324.545 942.946 293.139 1030.82 190.886 1090.71C98.4208 1144.86 1 1138.86 1 1074.5C1 984.086 145.266 967.699 240.997 1054.25C262.265 1073.48 281.137 1097.79 295.5 1127.5C354 1248.5 358 1336 446 1401"
          stroke="#FFF"
          stroke-dasharray="6 6"
					stroke-width="6px" 
        />
				<g ref={ref => star = ref}>
					<path
						d="M526.889 291.263L507.865 270.762L511.033 268.116L511.148 268.404L531.631 250.53C531.881 250.3 531.669 249.897 531.343 249.955L518.078 252.716C518.078 252.716 517.924 252.621 517.848 252.582L494.274 241.325C493.064 240.75 491.874 239.618 491.126 238.333L487.958 232.887L488.188 233.194L493.928 227.133L482.257 200.822C482.161 200.611 481.892 200.553 481.719 200.707L470.623 210.391C470.412 210.583 470.239 210.833 470.143 211.159L465.229 225.868L449.545 216.49C449.334 216.356 449.065 216.394 448.892 216.547L438.603 225.523L437.758 226.271C436.702 227.21 436.99 229.531 438.853 231.621L458.721 254.001C459.739 255.152 460.391 256.533 460.43 257.683L461.178 279.968C461.274 282.864 464.845 286.277 467.225 285.74L485.501 281.579C486.442 281.368 487.709 281.79 488.88 282.729L511.551 300.871C513.183 302.175 514.68 302.329 515.544 301.696L526.832 291.877C527.024 291.724 527.024 291.436 526.87 291.263H526.889Z"
						fill="#7C99FF"
					/>
					<path
						d="M444.88 236.819L445.725 236.071L455.995 227.096C456.187 226.942 456.456 226.904 456.648 227.038L472.332 236.397L477.246 221.688C477.361 221.362 477.515 221.112 477.726 220.92L487.421 212.463L482.257 200.822C482.161 200.611 481.892 200.554 481.719 200.707L470.623 210.392C470.412 210.584 470.239 210.833 470.143 211.159L465.229 225.868L449.545 216.49C449.334 216.356 449.065 216.395 448.892 216.548L438.603 225.523L437.758 226.271C436.702 227.211 436.99 229.531 438.853 231.622L444.324 237.797C444.42 237.394 444.592 237.068 444.861 236.819H444.88Z"
						fill="white"
					/>
					<path
						d="M467.533 268.251C467.494 267.1 466.861 265.719 465.824 264.568L460.43 258.508L461.159 279.987C461.255 282.883 464.826 286.297 467.206 285.76L468.089 285.549L467.513 268.27L467.533 268.251Z"
						fill="#7C99FF"
					/>
					<path
						d="M462.1 284.225C460.968 282.94 460.276 281.406 460.219 280.006L459.47 257.722C459.432 256.801 458.875 255.67 458.011 254.634L438.142 232.273C435.973 229.819 435.57 226.942 437.125 225.561L448.259 215.838C448.758 215.397 449.469 215.34 450.045 215.685L464.711 224.43L469.241 210.852C469.395 210.392 469.645 209.989 470.009 209.682L481.105 199.978C481.412 199.71 481.835 199.595 482.238 199.691C482.641 199.787 482.986 200.055 483.14 200.439L495.08 227.326L489.36 233.366L491.97 237.854C492.623 238.985 493.641 239.964 494.696 240.462L518.251 251.7L531.151 249.015C531.727 248.9 532.303 249.169 532.572 249.706C532.841 250.243 532.706 250.856 532.265 251.24L510.803 269.976L510.668 269.67L509.267 270.839L527.6 290.592C527.849 290.842 527.984 291.244 527.965 291.609C527.945 291.973 527.773 292.337 527.485 292.587L516.197 302.406C514.815 303.422 512.837 303.096 510.956 301.6L488.285 283.458C487.363 282.73 486.365 282.346 485.712 282.499L467.437 286.661C466.208 286.949 464.769 286.508 463.386 285.434C462.906 285.069 462.484 284.666 462.1 284.225ZM459.489 253.426C460.622 254.73 461.332 256.303 461.39 257.664L462.139 279.949C462.177 281.234 463.175 282.864 464.557 283.938C465.46 284.628 466.381 284.954 467.015 284.82L485.29 280.658C486.538 280.371 488.054 280.869 489.475 282.001L512.146 300.143C513.433 301.178 514.527 301.293 514.987 300.948L525.815 291.551L506.483 270.724L511.398 266.62L511.513 266.87L529.193 251.432L517.944 253.771L517.445 253.503L493.871 242.246C492.489 241.574 491.145 240.328 490.32 238.87L487.152 233.424L487.882 232.945L487.517 232.599L492.815 226.999L481.719 201.973L471.257 211.101C471.257 211.101 471.103 211.293 471.046 211.446L465.767 227.287L449.315 217.468L438.392 226.999C437.835 227.479 438.046 229.339 439.582 230.988L459.451 253.369L459.509 253.426H459.489Z"
						fill="#141516"
					/>
					<path
						d="M488.112 203.373L502.586 228.342C503.335 229.627 504.506 230.758 505.735 231.333L529.308 242.591C532.38 244.048 534.319 248.248 532.591 249.686L519.326 260.771C518.635 261.346 518.501 262.459 518.942 263.744L527.504 288.694C528.617 291.935 525.968 293.219 523.012 290.861L500.34 272.719C499.169 271.779 497.902 271.357 496.962 271.568L478.686 275.73C476.306 276.267 472.735 272.872 472.639 269.957L471.891 247.673C471.852 246.522 471.219 245.141 470.182 243.991L450.294 221.63C447.702 218.715 448.144 215.339 451.043 215.896L473.254 220.249C474.405 220.479 475.269 220.057 475.576 219.117L481.585 201.148C482.372 198.808 486.211 200.112 488.093 203.373H488.112Z"
						fill="white"
					/>
					<path
						d="M452.367 223.528L470.393 243.818C471.41 244.969 472.063 246.35 472.102 247.5L472.85 269.785C472.946 272.68 476.517 276.094 478.897 275.557L497.173 271.396C498.113 271.185 499.38 271.607 500.551 272.546L517.713 286.258L512.05 269.765C511.609 268.481 511.743 267.368 512.434 266.793L519.095 261.231C519.211 260.982 519.345 260.752 519.537 260.579L526.179 255.037C526.909 253.254 525.085 249.878 522.417 248.613L498.843 237.355C497.633 236.78 496.443 235.649 495.695 234.364L481.22 209.394C480.779 208.647 480.241 207.994 479.646 207.458L475.807 218.964C475.499 219.904 474.616 220.306 473.484 220.096L470.585 219.52L468.704 225.158C468.397 226.079 467.514 226.501 466.381 226.29L452.367 223.548V223.528Z"
						fill="#F14C4C"
					/>
					<path
						d="M473.541 274.234C472.409 272.949 471.718 271.415 471.66 270.015L470.911 247.73C470.873 246.81 470.316 245.563 469.452 244.643L449.584 222.282C447.818 220.23 447.146 217.794 448.048 216.202C448.662 215.148 449.814 214.687 451.235 214.975L473.445 219.328C474.117 219.463 474.52 219.29 474.674 218.849L480.683 200.841C481.028 199.786 481.873 199.134 482.967 199.019C485.002 198.808 487.517 200.438 488.937 202.893L503.412 227.862C504.064 228.994 505.082 229.972 506.138 230.471L529.711 241.728C531.957 242.802 533.858 245.314 534.146 247.558C534.299 248.766 533.954 249.782 533.186 250.434L519.921 261.5C519.556 261.807 519.518 262.555 519.825 263.437L528.387 288.387C529.001 290.19 528.694 291.724 527.542 292.529C526.218 293.45 524.24 293.104 522.378 291.609L499.707 273.467C498.785 272.738 497.787 272.354 497.134 272.508L478.859 276.669C477.63 276.957 476.191 276.516 474.808 275.442C474.328 275.078 473.906 274.675 473.522 274.234H473.541ZM470.931 243.435C472.082 244.739 472.773 246.311 472.831 247.673L473.58 269.957C473.618 271.242 474.616 272.872 475.999 273.946C476.901 274.636 477.822 274.963 478.456 274.828L496.731 270.667C497.979 270.379 499.496 270.878 500.916 272.009L523.588 290.151C524.893 291.187 525.987 291.321 526.448 290.995C526.851 290.707 526.889 289.959 526.582 289.039L518.02 264.089C517.445 262.401 517.694 260.905 518.692 260.062L531.957 248.977C532.284 248.708 532.284 248.191 532.245 247.826C532.073 246.388 530.767 244.374 528.886 243.473L505.312 232.216C503.93 231.544 502.586 230.298 501.761 228.84L487.267 203.852C486.134 201.896 484.253 200.822 483.159 200.937C482.813 200.975 482.602 201.129 482.487 201.455L476.498 219.443C476.037 220.824 474.693 221.534 473.081 221.208L450.87 216.854C450.275 216.739 449.891 216.854 449.718 217.161C449.373 217.756 449.488 219.405 451.023 221.016L470.892 243.396L470.95 243.454L470.931 243.435Z"
						fill="#141516"
					/>
					<path
						d="M474.655 274.061L463.213 284.052L465.92 285.683L487.152 281.77L499.073 271.357L495.483 271.798L478.667 275.749L476.306 275.94L474.655 274.061Z"
						fill="#141516"
					/>
					<path
						d="M470.756 245.291L459.353 255.25L460.616 256.694L472.02 246.735L470.756 245.291Z"
						fill="#141516"
					/>
					<path
						d="M450.455 222.06L439.051 232.019L440.315 233.462L451.718 223.504L450.455 222.06Z"
						fill="#141516"
					/>
					<path
						d="M521.457 290.017L510.246 299.798L513.087 302.099L515.564 301.696L526.237 292.376L521.457 290.017Z"
						fill="#141516"
					/>
				</g>
				<Stars/>
      </svg>
    </div>
  );
};
